@echo off
title MalwareDiagnosticv0.2

:: Check for admin rights
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo.
    echo *** Administrator privileges are required. ***
    echo Please approve the UAC prompt.
    powershell -Command "Start-Process '%~f0' -Verb runAs"
    exit /b
)

:MENU
cls
echo ================================
echo   Malware Diagnostic v0.2
echo ================================
echo.
echo 1. Start Quick Scan
echo 2. Get Scan Status
echo 3. Open Windows Security
echo 4. Update Antivirus Definitions
echo 5. Run Full Scan
echo 6. Clear Scan History
echo 7. Exit
echo.
set /p choice=Choose an option (1-7): 

if "%choice%"=="1" goto QuickScan
if "%choice%"=="2" goto GetStatus
if "%choice%"=="3" goto OpenSecurity
if "%choice%"=="4" goto UpdateDefs
if "%choice%"=="5" goto FullScan
if "%choice%"=="6" goto ClearHistory
if "%choice%"=="7" goto Exit

echo Invalid choice. Try again.
pause
goto MENU

:QuickScan
cls
echo Starting Windows Defender Quick Scan...
powershell -NoProfile -Command ^
"Try { ^
    $svc = Get-Service WinDefend -ErrorAction Stop; ^
    if ($svc.Status -ne 'Running') { Start-Service WinDefend; Start-Sleep 2 } ^
    Write-Host 'Running Quick Scan...'; ^
    Start-MpScan -ScanType QuickScan; ^
    Write-Host 'Quick Scan completed successfully.' ^
} Catch { ^
    Write-Host 'Error: ' $_.Exception.Message ^
}"
pause
goto MENU

:GetStatus
cls
echo Fetching Windows Defender status...
powershell -NoProfile -Command ^
"Try { ^
    $status = Get-MpComputerStatus; ^
    Write-Host 'Real-Time Protection: ' $status.RealTimeProtectionEnabled; ^
    Write-Host 'Antivirus Enabled: ' $status.AntivirusEnabled; ^
    Write-Host 'Threats Detected: ' $status.DetectedThreats; ^
    Write-Host 'Last Quick Scan Time: ' $status.QuickScanEndTime; ^
} Catch { ^
    Write-Host 'Error: ' $_.Exception.Message ^
}"
pause
goto MENU

:OpenSecurity
cls
echo Opening Windows Security app...
powershell -NoProfile -Command "Start-Process 'windowsdefender:'"
echo Windows Security should now be open.
pause
goto MENU

:UpdateDefs
cls
echo Updating Windows Defender Antivirus definitions...
powershell -NoProfile -Command ^
"Try { ^
    Update-MpSignature; ^
    Write-Host 'Antivirus definitions updated successfully.' ^
} Catch { ^
    Write-Host 'Error: ' $_.Exception.Message ^
}"
pause
goto MENU

:FullScan
cls
echo Starting Windows Defender Full Scan...
powershell -NoProfile -Command ^
"Try { ^
    $svc = Get-Service WinDefend -ErrorAction Stop; ^
    if ($svc.Status -ne 'Running') { Start-Service WinDefend; Start-Sleep 2 } ^
    Write-Host 'Running Full Scan... This may take a while.'; ^
    Start-MpScan -ScanType FullScan; ^
    Write-Host 'Full Scan completed successfully.' ^
} Catch { ^
    Write-Host 'Error: ' $_.Exception.Message ^
}"
pause
goto MENU

:ClearHistory
cls
echo Clearing Windows Defender scan history...
powershell -NoProfile -Command ^
"Try { ^
    Remove-Item -Path '$env:ProgramData\Microsoft\Windows Defender\Scans\History\*' -Recurse -Force -ErrorAction SilentlyContinue; ^
    Write-Host 'Scan history cleared.' ^
} Catch { ^
    Write-Host 'Error: ' $_.Exception.Message ^
}"
pause
goto MENU

:Exit
echo Exiting MalwareDiagnosticv0.2...
exit /b
